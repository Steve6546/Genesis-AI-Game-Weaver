# تنسيق مخطط اللعبة (Game Schema Format)

يتم تعريف كل لعبة في مشروع Genesis AI Game Weaver من خلال مخطط JSON يتبع بنية محددة. هذا المستند يشرح بالتفصيل هذه البنية والحقول المختلفة التي يمكن استخدامها.

يتم التحقق من صحة مخططات الألعاب مقابل تعريف JSON Schema موجود في `game_schema_validator.py` (المتغير `GAME_SCHEMA_DEFINITION`).

## 1. البنية العامة للمخطط (Overall Schema Structure)

مخطط اللعبة هو كائن JSON (كائن Python dict) يحتوي على الحقول التالية على المستوى الأعلى:

```json
{
  "game_title": "اسم اللعبة",
  "screen_dimensions": { "width": 800, "height": 600 },
  "background_color": [30, 30, 30],
  "entities": [ /* قائمة بالكيانات */ ],
  "game_rules": [ "قاعدة 1", "قاعدة 2" ]
}
```

### حقول المستوى الأعلى:

*   **`game_title`** (سلسلة نصية - string, مطلوب):
    *   الوصف: عنوان اللعبة الذي سيظهر في شريط عنوان النافذة.
    *   مثال: `"Space Invaders Clone"`
*   **`screen_dimensions`** (كائن - object, مطلوب):
    *   الوصف: يحدد أبعاد شاشة اللعبة بالبكسل.
    *   **`width`** (عدد صحيح - integer, مطلوب): عرض الشاشة.
    *   **`height`** (عدد صحيح - integer, مطلوب): ارتفاع الشاشة.
    *   مثال: `"screen_dimensions": { "width": 1024, "height": 768 }`
*   **`background_color`** (مصفوفة من الأعداد الصحيحة - array of integers, مطلوب):
    *   الوصف: لون خلفية اللعبة، ممثل بقيم RGB (أحمر، أخضر، أزرق).
    *   يجب أن تحتوي المصفوفة على 3 أعداد صحيحة، كل منها بين 0 و 255.
    *   مثال: `"background_color": [0, 0, 0]` (أسود), `"background_color": [135, 206, 235]` (أزرق سماوي)
*   **`entities`** (مصفوفة من الكائنات - array of objects, مطلوب):
    *   الوصف: قائمة تحتوي على تعريفات كل الكيانات (الشخصيات، الأعداء، المقذوفات، العقبات، إلخ) في اللعبة.
    *   سيتم شرح بنية كل كائن كيان بالتفصيل أدناه.
*   **`game_rules`** (مصفوفة من السلاسل النصية - array of strings, اختياري):
    *   الوصف: قائمة بقواعد اللعبة أو أي نصوص إرشادية تود عرضها على الشاشة.
    *   مثال: `"game_rules": ["استخدم الأسهم للحركة", "اضغط Space للإطلاق", "تجنب الأعداء!"]`

## 2. بنية كائن الكيان (Entity Object Structure)

كل عنصر في مصفوفة `entities` هو كائن يمثل كيانًا في اللعبة. يحتوي كل كائن كيان على الحقول التالية:

```json
{
  "id": "unique_entity_id",
  "name": "اسم الكيان",
  "type": "player" /* أو enemy, obstacle, projectile, other */,
  "shape": "rectangle" /* أو circle */,
  "color": [255, 0, 0],
  "size": { /* يعتمد على الشكل */ },
  "position": { "x": 100, "y": 200 },
  "speed": 5,
  "movement_pattern": "static" /* أو أنماط أخرى */,
  "is_controllable": false,
  "health_points": 100,
  "can_shoot": false,
  "projectile_archetype": { /* إذا كان can_shoot صحيحًا */ }
}
```

### حقول كائن الكيان:

*   **`id`** (سلسلة نصية - string, مطلوب):
    *   الوصف: معرف فريد للكيان داخل اللعبة. يستخدم للتمييز بين الكيانات.
    *   مثال: `"player_1"`, `"enemy_ship_alpha"`
*   **`name`** (سلسلة نصية - string, اختياري):
    *   الوصف: اسم وصفي للكيان (يمكن استخدامه في الرسائل أو لأغراض التصحيح).
    *   مثال: `"Hero Spaceship"`, `"Red Obstacle"`
*   **`type`** (سلسلة نصية - string, مطلوب):
    *   الوصف: يحدد نوع الكيان. يؤثر على كيفية تفاعله في اللعبة (خاصة في الاصطدامات).
    *   القيم المسموح بها: `"player"`, `"enemy"`, `"obstacle"`, `"projectile"`, `"other"`.
*   **`shape`** (سلسلة نصية - string, مطلوب):
    *   الوصف: الشكل الهندسي للكيان.
    *   القيم المسموح بها: `"rectangle"`, `"circle"`.
*   **`color`** (مصفوفة من الأعداد الصحيحة - array of integers, مطلوب):
    *   الوصف: لون الكيان (RGB).
    *   مثال: `"color": [0, 255, 0]` (أخضر)
*   **`size`** (كائن - object, مطلوب):
    *   الوصف: يحدد أبعاد الكيان. الحقول الداخلية تعتمد على قيمة `shape`.
    *   **إذا كان `shape` هو `"rectangle"`:**
        *   `"width"` (عدد صحيح - integer, مطلوب): عرض المستطيل.
        *   `"height"` (عدد صحيح - integer, مطلوب): ارتفاع المستطيل.
        *   مثال: `"size": { "width": 50, "height": 30 }`
    *   **إذا كان `shape` هو `"circle"`:**
        *   `"radius"` (عدد صحيح - integer, مطلوب): نصف قطر الدائرة.
        *   مثال: `"size": { "radius": 25 }`
*   **`position`** (كائن - object, مطلوب):
    *   الوصف: الموضع الأولي للكيان على الشاشة (نقطة الإسناد هي الزاوية العلوية اليسرى للشاشة).
    *   **`x`** (عدد صحيح - integer, مطلوب): الإحداثي الأفقي (يزداد لليمين).
    *   **`y`** (عدد صحيح - integer, مطلوب): الإحداثي الرأسي (يزداد لأسفل).
    *   مثال: `"position": { "x": 0, "y": 0 }` (الزاوية العلوية اليسرى)
*   **`speed`** (عدد - number (integer or float), اختياري, الافتراضي: 0):
    *   الوصف: سرعة حركة الكيان (عدد البكسلات لكل تحديث إطار، أو وحدة أخرى حسب نمط الحركة).
*   **`movement_pattern`** (سلسلة نصية - string, اختياري, الافتراضي: `"static"`):
    *   الوصف: يحدد كيف يتحرك الكيان.
    *   القيم المسموح بها حاليًا:
        *   `"static"`: الكيان لا يتحرك.
        *   `"player_horizontal_control"`: يتحكم به اللاعب أفقيًا (يمين/يسار).
        *   `"player_omni_directional_control"`: يتحكم به اللاعب في جميع الاتجاهات (أعلى/أسفل/يمين/يسار).
        *   `"falling_down"`: يسقط لأسفل، ويعود للأعلى عند الخروج من الشاشة.
        *   `"moving_left_right_patrol"`: يتحرك أفقيًا بشكل دوري بين حافتي الشاشة.
        *   `"projectile_movement"`: حركة مخصصة للمقذوفات (عادةً للأمام في اتجاه واحد، حاليًا للأعلى).
*   **`is_controllable`** (قيمة منطقية - boolean, اختياري, الافتراضي: `false`):
    *   الوصف: إذا كان `true`، فهذا الكيان هو الذي يتحكم به اللاعب.
    *   (ملاحظة: حاليًا، يُفترض وجود كيان واحد فقط قابل للتحكم في اللعبة).
*   **`health_points`** (عدد صحيح - integer, اختياري):
    *   الوصف: نقاط صحة الكيان. يستخدم في نظام الضرر والاصطدامات.
    *   إذا وصل إلى 0 أو أقل، قد يتم تدمير الكيان.
*   **`can_shoot`** (قيمة منطقية - boolean, اختياري, الافتراضي: `false`):
    *   الوصف: إذا كان `true`، يمكن لهذا الكيان إطلاق مقذوفات (عادةً اللاعب).
    *   يتطلب وجود حقل `projectile_archetype` إذا كان `true`.
*   **`projectile_archetype`** (كائن - object, اختياري):
    *   الوصف: يصف خصائص المقذوفات التي يطلقها هذا الكيان. مطلوب فقط إذا كان `can_shoot` هو `true`.
    *   بنيته مفصلة في القسم التالي.

## 3. بنية كائن `projectile_archetype`

هذا الكائن يصف النموذج الأولي للمقذوفات التي يمكن أن يطلقها كيان ما.

```json
{
  "id_prefix": "bullet_",
  "name_prefix": "Player Bullet ",
  "type": "projectile",
  "shape": "circle",
  "size": { "radius": 5 },
  "color": [255, 255, 0],
  "speed": 10,
  "movement_pattern": "projectile_movement",
  "damage": 1,
  "lifespan_ms": 2000,
  "cooldown_ms": 500
}
```

### حقول `projectile_archetype`:

*   **`id_prefix`** (سلسلة نصية - string, اختياري, الافتراضي: `"proj_"`):
    *   الوصف: بادئة تُستخدم عند توليد `id` فريد لكل مقذوف يتم إطلاقه (يُضاف إليها عداد).
*   **`name_prefix`** (سلسلة نصية - string, اختياري, الافتراضي: `"Projectile "`):
    *   الوصف: بادئة لاسم المقذوف.
*   **`type`** (سلسلة نصية - string, مطلوب, يجب أن يكون `"projectile"` عادةً):
    *   الوصف: نوع الكيان للمقذوف.
*   **`shape`** (سلسلة نصية - string, مطلوب):
    *   الوصف: شكل المقذوف (`"rectangle"` أو `"circle"`).
*   **`size`** (كائن - object, مطلوب):
    *   الوصف: أبعاد المقذوف (نفس بنية `size` للكيان الرئيسي).
*   **`color`** (مصفوفة من الأعداد الصحيحة - array of integers, مطلوب):
    *   الوصف: لون المقذوف (RGB).
*   **`speed`** (عدد - number, مطلوب):
    *   الوصف: سرعة حركة المقذوف.
*   **`movement_pattern`** (سلسلة نصية - string, مطلوب, يجب أن يكون `"projectile_movement"` عادةً):
    *   الوصف: نمط حركة المقذوف.
*   **`damage`** (عدد صحيح - integer, اختياري, الافتراضي: 1):
    *   الوصف: مقدار الضرر الذي يلحقه المقذوف عند الاصطدام بهدف (مثل عدو).
*   **`lifespan_ms`** (عدد صحيح - integer, اختياري):
    *   الوصف: مدة بقاء المقذوف بالمللي ثانية. بعد هذه المدة، يتم إزالة المقذوف.
    *   إذا لم يتم توفيره، قد يبقى المقذوف حتى يخرج من الشاشة أو يصطدم بشيء.
*   **`cooldown_ms`** (عدد صحيح - integer, اختياري, الافتراضي: 250):
    *   الوصف: فترة التهدئة (الانتظار) بالمللي ثانية بين كل عملية إطلاق وأخرى من نفس الكيان.

## 4. ملاحظات هامة

*   هذا المخطط قابل للتوسع. مع إضافة ميزات جديدة للمشروع، قد يتم إضافة حقول جديدة أو تعديل الحقول الحالية.
*   الالتزام الدقيق بهذا التنسيق ضروري لضمان عمل محرك العرض بشكل صحيح.
*   يتم استخدام `game_schema_validator.py` كمرجع أساسي للتحقق من صحة أي مخطط لعبة.

هذا المستند يوفر فهمًا شاملاً لتنسيق مخطط اللعبة المستخدم في Genesis AI Game Weaver. للحصول على أمثلة عملية، راجع `docs/EXAMPLES.md` أو ملفات JSON الموجودة في جذر المشروع.
